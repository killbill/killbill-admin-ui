<div class="kaui-container kaui-account-tags-index">
  <%= render "kaui/components/breadcrumb/breadcrumb" %>
  <div class="d-flex " style="gap: 4rem;">
    <%= render :template => 'kaui/layouts/kaui_account_sidebar' %>
    <div class="account-tags">
      <div class="d-flex flex-column ">
        <div class="account-tags-header mb-4">
          <div class="d-flex align-items-center">
            <h2>Tags</h2>
          </div>
          <input type="hidden" id="tags" value="<%= @tags_json %>">
        </div>
        <table id="tags-table" class="account-tags-table">
          <thead>
          <tr>
            <th class="sortable-header" data-column="0">
              <div class="header-content">
                <span class="header-text">Tag ID</span>
                <div class="sort-icons">
                  <%= image_tag "sort-up.svg", class: "sort-icon sort-asc" %>
                  <%= image_tag "sort-down.svg", class: "sort-icon sort-desc" %>
                </div>
              </div>
            </th>
            <th class="sortable-header" data-column="1">
              <div class="header-content">
                <span class="header-text">Object ID</span>
                <div class="sort-icons">
                  <%= image_tag "sort-up.svg", class: "sort-icon sort-asc" %>
                  <%= image_tag "sort-down.svg", class: "sort-icon sort-desc" %>
                </div>
              </div>
            </th>
            <th class="sortable-header" data-column="2">
              <div class="header-content">
                <span class="header-text">Object type</span>
                <div class="sort-icons">
                  <%= image_tag "sort-up.svg", class: "sort-icon sort-asc" %>
                  <%= image_tag "sort-down.svg", class: "sort-icon sort-desc" %>
                </div>
              </div>
            </th>
            <th class="sortable-header" data-column="3">
              <div class="header-content">
                <span class="header-text">Tag definition name</span>
                <div class="sort-icons">
                  <%= image_tag "sort-up.svg", class: "sort-icon sort-asc" %>
                  <%= image_tag "sort-down.svg", class: "sort-icon sort-desc" %>
                </div>
              </div>
            </th>
          </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
    $(document).ready(function() {
        var tags = JSON.parse($("#tags").val());
        var table = $('#tags-table').DataTable({
            "dom": "<'row'<'col-md-6'l><'col-md-6'f>r>t<'row'<'col-md-6'i><'col-md-6'p>>",
            data: tags
        });

        // Custom sorting functionality
        var currentSortColumn = -1;
        var currentSortDirection = 'asc';

        // Handle custom header clicks
        $('.sortable-header').on('click', function() {
          var columnIndex = parseInt($(this).data('column'));
          var newDirection = 'asc';
          
          // If clicking the same column, toggle direction
          if (currentSortColumn === columnIndex) {
            newDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
          }
          
          currentSortColumn = columnIndex;
          currentSortDirection = newDirection;
          
          // Update visual indicators
          updateSortIndicators(columnIndex, newDirection);
          
          // Apply DataTable sorting
          table.order([columnIndex, newDirection]).draw();
        });

        // Function to update sort indicators
        function updateSortIndicators(columnIndex, direction) {
          // Reset all headers
          $('.sortable-header').removeClass('sort-asc-active sort-desc-active');
          $('.sort-icon').removeClass('active');
          
          // Set active state for current column
          var $header = $('.sortable-header[data-column="' + columnIndex + '"]');
          $header.addClass(direction + '-active');
          $header.find('.sort-' + direction).addClass('active');
        }
    });

    setTimeout(() => {
      $('#tags-table tbody tr').each(function () {
        const $td = $(this).find('td:nth-of-type(3)');
        const content = $td.text().trim();
        $td.html(`<span>${content}</span>`);
      });
    }, 50);
<% end %>
